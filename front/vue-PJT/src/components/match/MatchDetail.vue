<template>
  <div>
    <div class="detail-container">
      <div class="detail d-flex justify-content-evenly">
        <h4 style="margin-right: 100px;">ë¶„ë¥˜ : {{ detail.teamBId ? '[ë§ˆê°]' : '[ëª¨ì§‘]' }}</h4>
        <h4 style="margin-right: 100px;">ğŸ“†{{ detail.matchDate }}</h4>
        <h4>ğŸ•‘{{ detail.matchTime }}</h4>
      </div>

      <div class="row logo-container">
        <!-- Team A Logo -->
        <div class="col-md-5 logo">
          <template v-if="detail.teamAName === 'í† íŠ¸ë„˜'">
            <img src="@/asset/logo/í† íŠ¸ë„˜.png" alt="í† íŠ¸ë„˜ ë¡œê³ ">
          </template>
          <template v-if="detail.teamAName === 'ë¦¬ë²„í’€'">
            <img src="@/asset/logo/ë¦¬ë²„í’€.png" alt="ë¦¬ë²„í’€ ë¡œê³ ">
          </template>
          <template v-if="detail.teamAName === 'ë§¨ì‹œí‹°'">
            <img src="@/asset/logo/ë§¨ì‹œí‹°.png" alt="ë§¨ì‹œí‹° ë¡œê³ ">
          </template>
          <template v-if="detail.teamAName === 'ë§¨ìœ '">
            <img src="@/asset/logo/ë§¨ìœ .png" alt="ë§¨ìœ  ë¡œê³ ">
          </template>
          <template v-if="detail.teamAName === 'ì•„ìŠ¤ë„'">
            <img src="@/asset/logo/ì•„ìŠ¤ë„.png" alt="ì•„ìŠ¤ë„ ë¡œê³ ">
          </template>
          <template v-if="detail.teamAName === 'ì²¼ì‹œ'">
            <img src="@/asset/logo/ì²¼ì‹œ.png" alt="ì²¼ì‹œ ë¡œê³ ">
          </template>
        </div>

        <!-- Versus Text -->
        <div class="col-md-2 text-center versus">
          <h2 v-if="detail.teamBId">VS</h2>
        </div>

        <!-- Team B Logo -->
        <div class="col-md-5 logo" v-if="detail.teamBId">
          <template v-if="detail.teamBName === 'í† íŠ¸ë„˜'">
            <img src="@/asset/logo/í† íŠ¸ë„˜.png" alt="í† íŠ¸ë„˜ ë¡œê³ ">
          </template>
          <template v-if="detail.teamBName === 'ë¦¬ë²„í’€'">
            <img src="@/asset/logo/ë¦¬ë²„í’€.png" alt="ë¦¬ë²„í’€ ë¡œê³ ">
          </template>
          <template v-if="detail.teamBName === 'ë§¨ì‹œí‹°'">
            <img src="@/asset/logo/ë§¨ì‹œí‹°.png" alt="ë§¨ì‹œí‹° ë¡œê³ ">
          </template>
          <template v-if="detail.teamBName === 'ë§¨ìœ '">
            <img src="@/asset/logo/ë§¨ìœ .png" alt="ë§¨ìœ  ë¡œê³ ">
          </template>
          <template v-if="detail.teamBName === 'ì•„ìŠ¤ë„'">
            <img src="@/asset/logo/ì•„ìŠ¤ë„.png" alt="ì•„ìŠ¤ë„ ë¡œê³ ">
          </template>
          <template v-if="detail.teamBName === 'ì²¼ì‹œ'">
            <img src="@/asset/logo/ì²¼ì‹œ.png" alt="ì²¼ì‹œ ë¡œê³ ">
          </template>
        </div>
      </div>

      <div class="row">
        <!-- Team A Members -->
        <div class="col-md-6">
          <div class="team-container">
            <div class="team-a">
              <div class="team-leader">
                <h4>{{ detail.teamAName }}íŒ€ ë¦¬ë” : {{ detail.authorName }}</h4>
              </div>
              <div class="team-member">
                <h4 v-for="member in teamAMember" :key="member.id" class="team-member">
                  {{ member.memberName }}
                </h4>
              </div>
            </div>
          </div>
        </div>

        <!-- Team B Members -->
        <div class="col-md-6" v-if="detail.teamBId">
          <div class="team-container">
            <div class="team-b">
              <div class="team-leader">
                <h4>{{ detail.teamBName }}íŒ€ ë¦¬ë” : {{ detail.teamBLeader }}</h4>
              </div>
              <div class="team-member">
                <h4 v-for="member in teamBMember" :key="member.id">
                  {{ member.memberName }}
                </h4>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div v-if="detail.stadiumId" class="stadium-container">
        <div class="row" v-if="imgSrc === 1">
          <div class="col-md-5">
            <img src="@/asset/stadium/ìœ ì„±í’‹ì‚´êµ¬ì¥/ìœ ì„±í’‹ì‚´êµ¬ì¥(1).png" alt="Stadium Image">
          </div>
          <div class="col-md-5">
            <img src="@/asset/stadium/ìœ ì„±í’‹ì‚´êµ¬ì¥/ìœ ì„±í’‹ì‚´êµ¬ì¥(2).png" alt="Stadium Image">
          </div>
          <div class="col-md-2">
            <div>{{ stadiumName }}</div>
            <div>{{ stadiumAddress }}</div>
            <div>ë‚´ìš© : {{ detail.content }}</div>
          </div>
        </div>
        <div class="row" v-if="imgSrc === 2">
          <div class="col-md-5">
            <img src="@/asset/stadium/ëŒ€ì „ê°€ì¥í’‹ì‚´ì¡´/ëŒ€ì „ê°€ì¥í’‹ì‚´ì¡´(1).png" alt="Stadium Image">
          </div>
          <div class="col-md-5">
            <img src="@/asset/stadium/ëŒ€ì „ê°€ì¥í’‹ì‚´ì¡´/ëŒ€ì „ê°€ì¥í’‹ì‚´ì¡´(2).png" alt="Stadium Image">
          </div>
          <div class="col-md-2">
            <div><h4>{{ stadiumName }}</h4></div>
            <div><h5>{{ stadiumAddress }}</h5></div>
            <div><h5>{{ detail.authorName }} : {{ detail.content }}</h5></div>
          </div>
        </div>
        <div class="row" v-if="imgSrc === 3">
          <div class="col-md-5">
            <img src="@/asset/stadium/ë‚¨ì„ ê³µì›í’‹ì‚´ì¥/ë‚¨ì„ ê³µì›í’‹ì‚´ì¥(1).png" alt="Stadium Image">
          </div>
          <div class="col-md-5">
            <img src="@/asset/stadium/ë‚¨ì„ ê³µì›í’‹ì‚´ì¥/ë‚¨ì„ ê³µì›í’‹ì‚´ì¥(2).png" alt="Stadium Image">
          </div>
          <div class="col-md-2">
            <div>{{ stadiumName }}</div>
            <div>{{ stadiumAddress }}</div>
            <div>ë‚´ìš© : {{ detail.content }}</div>
          </div>
        </div>
        <div class="row" v-if="imgSrc === 4">
          <div class="col-md-5">
            <img src="@/asset/stadium/ê°€ì˜¤í’‹ì‚´ì¥/ê°€ì˜¤í’‹ì‚´ì¥(1).png" alt="Stadium Image">
          </div>
          <div class="col-md-5">
            <img src="@/asset/stadium/ê°€ì˜¤í’‹ì‚´ì¥/ê°€ì˜¤í’‹ì‚´ì¥(2).png" alt="Stadium Image">
          </div>
          <div class="col-md-2">
            <div>{{ stadiumName }}</div>
            <div>{{ stadiumAddress }}</div>
            <div>ë‚´ìš© : {{ detail.content }}</div>
          </div>
        </div>
      </div>
      <div class="buttons">
        <div v-if="detail.teamBId == 0 && detail.authorName !== nickName">
          <button @click="registMatch()">ì‹ ì²­í•˜ê¸°</button>
        </div>
        <div v-if="detail.teamBLeader === nickName">
          <button @click="cancelMatch()">ì‹ ì²­ì·¨ì†Œ</button>
        </div>
        <div v-if="detail.authorName === nickName">
          <router-link :to="{ name: 'matchupdate', params: { id: detail.id } }">
            <button>ìˆ˜ì •í•˜ê¸°</button>
          </router-link>
        </div>
        <div v-if="detail.authorName === nickName">
          <button @click="deleteMatch()">ì‚­ì œí•˜ê¸°</button>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted, watch } from "vue";
import { useRoute, useRouter } from "vue-router";
import axios from "@/api/axios";
import { useMatchStore } from "@/stores/match";

const detail = ref([]);
const nickName = ref('');
const teamAMember = ref([]);
const teamBMember = ref([]);
const route = useRoute();
const router = useRouter();
const imgSrc = ref('');
const store = useMatchStore();

// ê²½ê¸°ì¥ ì´ë¦„, ì¥ì†Œ
const stadiumName = ref('');
const stadiumAddress = ref('');

const detailPost = async (id) => {
  try {
      const response = await axios.get(`/futsal/match/${id}`);
      detail.value = response.data;
      detail.value.matchTime = detail.value.matchTime.split(':').slice(0, 2).join(':');
      stadiumName.value = store.stadiums[response.data.stadiumId-1].name;
      stadiumAddress.value = store.stadiums[response.data.stadiumId-1].address;
      console.log(response.data);
      showTeamA();
      if (detail.value.teamBId) {
          showTeamB();
      }
      imgSrc.value = detail.value.stadiumId;
  } 
  catch (error) {
      console.error(error);
  }
};

const registMatch = async () => {
  try {
      const response = await axios.put(`/futsal/match/${route.params.id}/regist`);
      detail.value = response.data;
      console.log(response.data);
      if (detail.value.teamBId) {
          showTeamB();
      }
  }
  catch (error) {
      console.log(error)
  }
}

const cancelMatch = async () => {
  try {
      const response = await axios.delete(`/futsal/match/${route.params.id}/cancel`);
      detail.value = response.data;
      console.log(response.data)
      // ìƒˆë¡œê³ ì¹¨
      location.reload();
  }
  catch (error) {
      console.log(error)
  }
}

const deleteMatch = async () => {
  try {
      await axios.delete(`/futsal/match/${route.params.id}`);
      router.push('/match');
  }
  catch (error) {
      console.log(error)
  }
}

const showTeamA = async () => {
  try {
      const response = await axios.get(`/futsal/board/team/${detail.value.teamAId}`);
      teamAMember.value = response.data;
  }
  catch (error) {
      console.log(error)
  }
}

const showTeamB = async () => {
  try {
      const response = await axios.get(`/futsal/board/team/${detail.value.teamBId}`);
      teamBMember.value = response.data;
  }
  catch (error) {
      console.log(error)
  }
}

onMounted(() => {
  nickName.value = sessionStorage.getItem("nickName");
  detailPost(route.params.id);
});
</script>

<style scoped>
.row img {
  max-width: 100%;
  height: auto;
}

.detail-container {
  margin-top: 100px;
  margin-left: 250px;
  margin-right: 250px;
  border: 1px solid #ccc;
  border-radius: 5px;
  padding: 20px;
}

.detail {
  margin: 30px;
}

.logo-container {
  margin: 70px;
  display: flex;
  justify-content: space-around;
  align-items: center;
  text-align: center;
}

.team-container {
  margin: 70px;
}

.team-leader {
  margin: 30px;
  border: 1px solid #ccc;
  border-radius: 5px;
  padding: 20px;
}

.team-member {
  border: 1px solid #ccc;
  border-radius: 5px;
  padding: 20px;
}

.field {
  max-width: 30%;
  height: auto;
}

.versus {
  display: flex;
  justify-content: center;
  align-items: center;
}

.buttons {
  display: flex;
  align-items: flex-end;
  gap: 10px;
}
</style>